<div class="container">
  <mat-card class="card">
    <h1 class="title">Restablecer contraseña</h1>

    <div class="masked">
      <mat-icon>mail</mat-icon>
      <span>{{ maskedEmail || 'correo oculto' }}</span>
    </div>

    <form [formGroup]="form" (ngSubmit)="submit()">
      <input type="hidden" formControlName="email" />

      <mat-form-field appearance="fill" class="full">
        <mat-label>Código</mat-label>
        <mat-icon matPrefix>verified</mat-icon>
        <input matInput formControlName="code" placeholder="Ingresa el código" />
        <mat-error *ngIf="form.controls['code'].touched && form.controls['code'].hasError('required')">Este campo es obligatorio</mat-error>
      </mat-form-field>

      <div class="row">
        <button mat-stroked-button color="primary" type="button" (click)="verify()" [disabled]="loading">Verificar</button>
        <span *ngIf="isVerified" class="ok">Código verificado</span>
      </div>

      <mat-form-field appearance="fill" class="full">
        <mat-label>Nueva contraseña</mat-label>
        <mat-icon matPrefix>lock</mat-icon>
        <input matInput [type]="hidePassword ? 'password' : 'text'" formControlName="password" placeholder="Ingresa tu nueva contraseña" />
        <button mat-icon-button matSuffix type="button" (click)="hidePassword = !hidePassword" aria-label="Mostrar/Ocultar"><mat-icon>{{ hidePassword ? 'visibility' : 'visibility_off' }}</mat-icon></button>
        <mat-hint>Mínimo 8 caracteres</mat-hint>
        <mat-error *ngIf="form.controls['password'].touched && form.controls['password'].hasError('required')">Este campo es obligatorio</mat-error>
        <mat-error *ngIf="form.controls['password'].touched && form.controls['password'].hasError('minlength')">Mínimo 8 caracteres</mat-error>
      </mat-form-field>

      <button mat-raised-button color="primary" class="full" [disabled]="loading || !isVerified || form.invalid">{{ loading ? 'Cargando...' : 'Restablecer' }}</button>
      <p *ngIf="status" class="status">{{ status }}</p>
    </form>
  </mat-card>
</div>